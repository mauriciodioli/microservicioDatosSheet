<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Bus Workflow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script>
        function triggerEvent() {
            const eventType = document.getElementById("eventType").value;
            const eventData = document.getElementById("eventData").value;
            const user_id = 1;  // Aquí defines el user_id
        
            fetch("/trigger_event", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    tipo: eventType,
                    datos: { message: eventData },
                    user_id: user_id  // Agregamos el user_id al cuerpo de la solicitud
                })
            })
            .then(response => response.json())
            .then(data => {
                alert("Evento enviado: " + JSON.stringify(data));
        
                // Vaciar los campos del formulario después de que el evento haya sido enviado correctamente
                document.getElementById("eventType").value = '';
                document.getElementById("eventData").value = '';
            })
            .catch(error => {
                console.error("Error:", error);
            });
        }
        

        function addWorkflow() {
            const workflowName = document.getElementById("workflowName").value;
            const eventTrigger = document.getElementById("eventTrigger").value;
            const usuarioId = 1;  // O obtén el valor dinámicamente si es necesario
        
            const requestData = {
                nombre: workflowName,
                usuario_id: usuarioId,  // Añade el usuario_id si es necesario en tu backend
                configuraciones: { evento: eventTrigger }
            };
        
            fetch("/add_workflow", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert("Workflow agregado: " + JSON.stringify(data));
                    // Vaciar los campos del formulario
                    document.getElementById("workflowName").value = '';
                    document.getElementById("eventTrigger").value = '';
                } else {
                    alert("Hubo un error al agregar el workflow.");
                }
            })
            .catch(error => console.error("Error:", error));
        }
        
    </script>
</head>
<body class="container mt-5">
    <h1 class="text-center">Event Bus Workflow</h1>
    
    <div class="card p-4 mt-4">
        <h2>Disparar Evento</h2>
        <div class="mb-3">
            <label for="eventType" class="form-label">Tipo de Evento:</label>
            <input type="text" id="eventType" class="form-control" placeholder="Ej. click, webhook">
        </div>
        <div class="mb-3">
            <label for="eventData" class="form-label">Datos del Evento:</label>
            <input type="text" id="eventData" class="form-control" placeholder="Mensaje opcional">
        </div>
        <button class="btn btn-primary" onclick="triggerEvent()">Enviar Evento</button>
    </div>
    
    <div class="card p-4 mt-4">
        <h2>Agregar Workflow</h2>
        <div class="mb-3">
            <label for="workflowName" class="form-label">Nombre del Workflow:</label>
            <input type="text" id="workflowName" class="form-control">
        </div>
        <div class="mb-3">
            <label for="eventTrigger" class="form-label">Evento a Escuchar:</label>
            <input type="text" id="eventTrigger" class="form-control" placeholder="Ej. click">
        </div>
        <button class="btn btn-success" onclick="addWorkflow()">Crear Workflow</button>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
